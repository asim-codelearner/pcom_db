{% extends 'database_app/base.html' %}
{% load forms_css %}
{% block content %}
	<div>
		<p><strong>Welcome, {{users_name}}</strong></p>
	</div>	
	{% if custom_message %}
		<p>
			{{ custom_message }}
		</p>
	{% endif %}

	<div>
		<table class="table table-bordered table-striped table-condensed">
			<caption>Company List</caption>
			<thead>
				<tr>
					<th>Company Name</th>
					<th>City</th>
					<th>Contact Person</th>
					<th>Designation</th>
					<th>Contact Info</th>
					<th>Status</th>
					<th>Logs</th>
				</tr>
			</thead>
			<tbody>
				{% for company in object_list %}
				<tr>
					<td>{{company.company_name}}</td>
					{% for details in company.company_details_set.all %}
						{% if details.is_correct_contact = True %}	
						<td>{{details.city}}</td>
						<td>{{details.salutation}}
							{{details.first_name}}
							{{details.last_name}}</td>
						<td>{{details.designation}}</td>
						<td><p><span class="glyphicon glyphicon-phone-alt"></span> :&nbsp;&nbsp;&nbsp;&nbsp;{{details.board_number}}</p>
							<p><span class="glyphicon glyphicon-phone"></span> :&nbsp;&nbsp;&nbsp;&nbsp;{{details.mobile_number}}</p>
							<p><span class="glyphicon glyphicon-envelope"></span> :&nbsp;&nbsp;&nbsp;&nbsp;{{details.e_mail}}</p></td>
						<td>{{company.status}}</td>
						{% with logs=details.logs_set.all|dictsort:"timestamp"|last %}
						<td>
							<form action="" method="post" class="form-horizontal">
								{% csrf_token %}
								<div class="form-group">
									<div class="col-lg-12">
										{{logs_form.logs|add_css_to_form:"class:form-control"}}
									</div>
								</div>
								<div class="form-group">
									<div class="col-lg-12">
										<input type="hidden" name="company_details_id" value={{details.id}}>
										<button type="submit" class="btn btn-primary">Submit log</button>
									</div>
								</div>
							</form>
							<br>
							{% if logs %}
								<p><span class="glyphicon glyphicon-comment"></span> &nbsp;&nbsp;&nbsp;&nbsp;[{{logs.timestamp}}] {{logs.logs}}<p>
							{% endif %}</td>
						{% endwith %}
						{% endif %}
					{% endfor %}
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</div>
	
	{% if is_paginated %}
		{% if page_obj.has_previous %}
			<a href="/landing?page={{ page_obj.previous_page_number }}">previous</a>
		{% endif %}
		Page {{page_obj.number}} of {{page_obj.paginator.num_pages}}
		{% if page_obj.has_next %}
			<a href="/landing?page={{ page_obj.next_page_number }}">next</a>
		{% endif %}
	{% endif %}
{% endblock %}